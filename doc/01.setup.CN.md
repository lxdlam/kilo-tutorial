# 基础环境搭建

嗯，第一步。

## 怎么安装一个C语言编译器...

### ...在Windows上

你需要**在Windows上安装一种（类）Linux环境**，这是因为我们的编辑器需要直接和终端交互并运作在一个较低的层级上。这需要使用`<termios.h>`头文件，然而在Windows上并没有这个文件。我建议你使用[Bash on Windows](https://msdn.microsoft.com/zh-cn/commandline/wsl/about)或者[Cygwin](https://www.cygwin.com/)。

**Bash on Windows**：Windows10上的Ubuntu子系统。请确保你的系统是64位的Windows10最新版。这里是[安装教程](https://msdn.microsoft.com/zh-cn/commandline/wsl/install_guide)（英文）。安装结束后，直接在CMD或者Powershell中运行`bash`命令即可进入Linux环境。进入Linux子系统之后请运行`sudo apt-get install gcc make`安装GCC编译器和`make`。如果使用`sudo`让你等了太久时间，请搜索*更换Ubuntu软件源*。

**Cygwin**: 从[这里](https://cygwin.com/install.html)下载安装包进行安装。在安装程序询问你要安装哪些程序包这一步，在`devel`这个选项内选中`gcc-core`和`make`这两个包。使用Cygwin很简单，运行Cygwin的终端即可。和Linux子系统不同，Cygwin下的`home`目录和你的Windows用户账户目录不是一个。也就是说，假如你在`C:\cygwin64`下安装了Cygwin，你的`home`目录就在`C:\cygwin64\home\yourname`。所以如果你想在Cygwin环境外面使用这个编辑器写代码的话，这个文件夹就是你应该去找程序的地方。

### ...在macOS上

当你尝试运行`cc`命令的时候，一个对话框会跳出来问你是否安装命令行开发者工具。你也可以运行`xcode-select --install`命令来让这个框弹出。之后你只需要点击“安装”，包括C编译器和`make`在内的众多开发工具都会帮你装好。

### ...在Linux上

在Ubuntu上面，运行`sudo apt-get install gcc make`即可。其他发行版应该也有`gcc`和`make`这两个包，搜索一下你的发行版配合“gcc make”这两个关键词看看。

## `main()`函数

新建一个文件并命名为`kilo.c`并且在其中写入一个`main()`函数。（`kilo`就是我们要做的编辑器的名字啦。）

{{main}}

在C语言中，你需要把所有*可运行的代码*放进*函数*里。然而，`main()`函数对于C语言来说是一个特殊的存在。这个函数是任何一个C程序的默认起点。当你从一个`main()`函数*返回*(`return`)后，程序就退出并且返回一个整形数字给操作系统。`0`意味着程序正常退出。

C语言是一种编译型语言。这意味着我们需要先使用我们的C语言编译器把源代码编译成可执行文件再运行。之后我们就可以像从命令行运行其他程序那样运行这个可执行文件。

要编译`kilo.c`，只需在你的终端中运行`cc kilo.c -o kilo`。如果什么错误都没发生，那么会多出一个名叫`kilo`的可执行文件。`-o`参数意味着”输出“("output")，并且特别指定了输出的程序名应该叫做`kilo`。

要运行`kilo`，在你的终端中输入`./kilo`并按下*回车*(<kbd>Enter</kbd>)。这个程序不会有任何输出，但是你可以看看它的退出状态（就是`main()`函数中返回那个）通过运行`echo $?`，结果应该是`0`.

## 使用`make`编译

每次都输入``cc kilo.c -o kilo`重新编译是很累人的。`make`会在你每次输入`make`的时候帮你编译你的程序。你只需要提供一个`Makefile`来告诉`make`该怎么编译你的程序。

创建一个新文件叫做`Makefile`，是的没有任何后缀。然后在这个文件中输入如下内容：

{{make}}

//Line 97

在[下一章](02.enteringRawMode.html)中，我们要写点代码让终端进入**原始模式**("raw mode")，并且读取每一次来自用户按键输入。